use std::collections::HashSet;

const INPUT_SAMPLE: &str = r".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............";

const INPUT: &str = r"......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^...^.^.^..................................................................
.............................................................................................................................................
.................................................................^...^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.^.....^.^................................................................
.............................................................................................................................................
...............................................................^...^.....^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^...^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.....^...^.....^.^.............................................................
.............................................................................................................................................
............................................................^...^.^.^.^.......^.^............................................................
.............................................................................................................................................
...........................................................^.^.^.^...^.^.^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.....^.^.^.^.....^.^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^.^.^...^.^.^.^...^...^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.....^.^.^.....^........................................................
.............................................................................................................................................
.......................................................^...^...^...^.^.^.....^.....^.^.......................................................
.............................................................................................................................................
......................................................^.^.^...^.^.^.^.^.^.^.^...^.^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^.......^.^.^.^.^.^.^...^.^.....................................................
.............................................................................................................................................
....................................................^...^.^.^.^...^...^.^.....^.^.^.^.^.^....................................................
.............................................................................................................................................
...................................................^.^.^.^...^.^...^.^.^.^...^...^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.....^.^...^.^...^.^...^.^...^...^..................................................
.............................................................................................................................................
.................................................^...^.^.^.....^.^.^.....^.^.^...^.^.^.^.^.^.................................................
.............................................................................................................................................
................................................^.^.........^.^.^.^.^.^.^.......^.^...^.^.^.^................................................
.............................................................................................................................................
...............................................^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^...............................................
.............................................................................................................................................
..............................................^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^.^...^...^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.......^...^.............................................
.............................................................................................................................................
............................................^...^.^.^.^...^.^.^.^.^.^.^.^.....^.^.^.^.^...^.^...^............................................
.............................................................................................................................................
...........................................^.^.^...^.^.^.^...^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^...........................................
.............................................................................................................................................
..........................................^...^...^.^...^.^.^...^.^.^.^...^...^.^...^.^...^.^.^...^..........................................
.............................................................................................................................................
.........................................^.^...^...^.^...^.^...^.^.....^.^.^...^.^...^.^.^.^.^.....^.........................................
.............................................................................................................................................
........................................^.^.^...^.^.^.....^...^.^...^.^...^.^.^.^...........^.^.^.^.^........................................
.............................................................................................................................................
.......................................^.^.^.^...^...^...^.^.^.^...^.^.^.^.^.....^.^...^.^.^.........^.......................................
.............................................................................................................................................
......................................^.^.^.^.^...^.....^.^.^...^.......^.^...^.....^.^...^.^.^.^...^.^......................................
.............................................................................................................................................
.....................................^...^.^.^.^.^...^...^.^.....^...^...^...^.^.......^.^.^...^...^.^.^.....................................
.............................................................................................................................................
....................................^.^...^.^...^.^.....^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^.^....................................
.............................................................................................................................................
...................................^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^...^...^.^...^.^...^...................................
.............................................................................................................................................
..................................^...^.^.^.^.^...^.^.^.........^.^.^...^.^.^.^.^.^.....^.^...^.^...^.....^..................................
.............................................................................................................................................
.................................^.^...^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^.^.^.^...^.^.^.^...^.....^...^.................................
.............................................................................................................................................
................................^.^.^.^.^.^.....^.^.^.^.^.....^.^...^...^...^...^.^.^...^.^.....^.^...^.....^................................
.............................................................................................................................................
...............................^...^...^.^...^.^.^.^.^...^.^.......^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.....^...^...............................
.............................................................................................................................................
..............................^...^.......^.^.^...^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.....^..............................
.............................................................................................................................................
.............................^.......^.^.^...^.^.^.^.^.^.^.^.........^.^...^.^.^.^.....^.....^...^.^.^...^.^.^.^.............................
.............................................................................................................................................
............................^.^.^.^.......^.....^.^.^.^...^.^...^.....^.....^...^...^.^.^.^...^.^.^...^.^.^.^.^.^............................
.............................................................................................................................................
...........................^...^.^.^.^.......^.^.^...^...^.^.^.^.^.^...^.....^.....^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...........................
.............................................................................................................................................
..........................^.^.^.^.^.^.....^...^.^.^.^.^.....^.......^.....^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.^.^.^..........................
.............................................................................................................................................
.........................^.^...^...^.^...^.....^...^...^...^.^.^.....^.^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^.........................
.............................................................................................................................................
........................^.^.^.^.^.^.^.^...^...........^...^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^........................
.............................................................................................................................................
.......................^...^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^...^.^...^.^.^...^...^.^.....^.^...^.^.......................
.............................................................................................................................................
......................^.^...^.....^.^...^...^.^.....^.^.^...^...^...^.^.^.^.^.^...^...^.^.^.......^...^.^.^.^...^.^.^.^......................
.............................................................................................................................................
.....................^.^...^...^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.....^.^.^.^...^.^...^.^.^...^.^...^.^.^...^.^.^.....................
.............................................................................................................................................
....................^.^.^...^.^...^.^.^.^.^.^.^.^...^.^...^.^.^.^...^.^.^...^.......^.^.....^.^.^...^.^.^...^.^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.....^.^.^.^.^.^.^.^.^...^.^.^...^...^.....^.^.^...^.....^.^.^...^.^...^.^.^.^...^.......^...^.^.^.^...................
.............................................................................................................................................
..................^.^.....^...^.^...^.^.^.^...^.^.^...^.^.^...^...^.^.....^...^.^.^.^.^.^...^.^.^.^...^.^.........^...^.^.^..................
.............................................................................................................................................
.................^...^.^.^.^.^.....^...^.^.^.^...^.^.^...^.^.^.^.^.^.......^.^.^.^.....^.........^...^.^...^.^.^.^.....^.^.^.................
.............................................................................................................................................
................^.^...^...^.^.^...^...^...^.^.^.^.^...^.....^.^.^...^.^.^.^...^.^.^.....^.^.^.^.....^...^.^.^.^.^...^.^.^.^.^................
.............................................................................................................................................
...............^.^.^...^...^.^.^.^...^.^.^.....^...^.^.^.^.^.^.^.^.^.^.........^...^.....^.^.^.^.^.^...^.^.^.^.^.......^.^...^...............
.............................................................................................................................................
..............^...^.^.^.^.^.^.^.^.^...^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^...^.^.....^.....^.....^...^.^..............
.............................................................................................................................................
.............^...^.....^.^.^...^.^...^...^.^.^.^...^...^.^.^.^...^...^.^.^.^...^...^.^.^...^...^...^...^.^...^...^.....^...^.^.^.............
.............................................................................................................................................
............^...^...^.^.^.^...^.^.^...^.^.....^...^.^...^.^.^.....^.....^.^.......^...^.^.^.^...^.^.^...^.^...^.^.^...^.^.^...^.^............
.............................................................................................................................................
...........^.^...^.....^.....^.^.^.....^.....^.^.^.^.^.........^.^.^.....^.^.^...^...^.^.^.^.^...^.^...^.^.^.^.....^...^.^.^...^.^...........
.............................................................................................................................................
..........^.^.^.^.^.^.^...^.^.^...^...^...^...^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.....^.^.^...^.^.^..........
.............................................................................................................................................
.........^.....^...^.^.^...^.^...^.^...^...^...^.^.^...^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^...^.^.........
.............................................................................................................................................
........^.^.^.^.^...^.^...^.^.^...^...^.^.^...^.....^.^.....^.^.^.^.^.^.^.^.^.^...^...^.....^.^.^.^.^.^.^.....^.^.^.^...^.^...^.^.^.^........
.............................................................................................................................................
.......^...^...^.^.^.....^.^.......^.^.^.^.^.^.......^.^...^.^.^.^.^.^.^.^.^.^.......^.^...^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^.^.......
.............................................................................................................................................
......^...^.^.^.^.^...^.^...^...^.........^...^.^.^.^.^.^...^...^.^.^.^.....^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^......
.............................................................................................................................................
.....^.^.^...^.^.^...^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^.^.^.^...........^.^...^.^...^.^.^.^...^...^.^.^.^.^.....
.............................................................................................................................................
....^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^.^...^...^.....^.....^...^.^.^.^.....^.^.^.^.......^.^...^...^.^.^.^...^.^.^.^.^...^.^.^...^.^....
.............................................................................................................................................
...^.^.....^.^.^...^.^.^.....^.^.^.....^.^.^.....^...^.^.......^.^.^.^.....^.^.....^...^...^...^.^...^.^.^.^.^...^.^.^.^.^...^...^...^.^.^...
.............................................................................................................................................
..^.....^.^.^.^.^.^.^.^...^...^.^.....^.^.....^.......^.^.^.....^...^...^.^.^.^...^.....^.^.^.^.^.^.^.^.^.......^.^.^.....^...^.^.^...^.^.^..
.............................................................................................................................................
.^.^.^.^.^.....^.^.^.^.^.^.^.^.^...^.....^.^...^...^.^...^...^.....^...^.^.......^.^.....^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^...^.^.^.
.............................................................................................................................................";

/// Get list of indexes of the beams for the given input
fn extract_beams(row: &str) -> HashSet<usize> {
    let mut indicies = HashSet::new();

    for (index, val) in row.chars().enumerate() {
        // got beam
        if val == '|' || val == 'S' {
            indicies.insert(index);
        } else {
        }
    }

    indicies
}

/// Get list of indexes of the splitters for the given input
fn extract_splits(row: &str) -> Vec<usize> {
    let mut indicies = vec![];

    for (index, val) in row.chars().enumerate() {
        // got beam
        if val == '^' {
            indicies.push(index);
        } else {
        }
    }

    indicies
}

fn evaluate(start: &str, next: &str) {}

fn apply_beams(beams: &HashSet<usize>, row: &str) -> (HashSet<usize>, u32) {
    let splitters = extract_splits(row);
    println!("  splitters: {splitters:?}");
    println!("      beams: {beams:?}");
    let mut splits = 0;
    let mut updated_beams = HashSet::new();

    for beam in beams {
        println!("      split: {beam}");
        if splitters.contains(&beam) {
            if *beam > 0usize {
                updated_beams.insert(*beam - 1usize);
            }
            updated_beams.insert(beam + 1);

            splits += 1;
        } else {
            updated_beams.insert(*beam);
        }
    }

    println!("    updated: {updated_beams:?}");

    (updated_beams, splits)
}

pub fn run() {
    let (start, splitters) = INPUT.split_once('\n').unwrap();
    let mut beams = extract_beams(start);
    let mut splits = 0;

    println!("start beams: {beams:?}");
    println!();

    for input in splitters.split('\n') {
        let (updated_beams, new_splits) = apply_beams(&beams, input);
        beams = updated_beams;
        splits += new_splits;

        println!();
    }

    println!("     splits: {splits}");
}
